#!/bin/sh
set -e

PACKAGE=toybox

case "$1" in
  build)
    make CC=clang defconfig
    make NOSTRIP=1 CC=clang CFLAGS="-Wno-uninitialized"
    ;;

  install)
    rm -rf /tmp/$PACKAGE
    mkdir -p /tmp/$PACKAGE
    PREFIX=/tmp/$PACKAGE/bin make CC=clang install_flat
    rm -rf /tmp/$PACKAGE/bin/reset /tmp/$PACKAGE/bin/clear /tmp/$PACKAGE/bin/uuidgen /tmp/$PACKAGE/bin/lsattr /tmp/$PACKAGE/bin/chattr /tmp/$PACKAGE/bin/blkid
    ;;

  clean)
    make clean
    ;;

  *)
    echo unknown argument $1
    ;;
esac
